<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MTR Duty Planner v41</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --primary: #007aff; --bg: #f2f2f7; --card: #ffffff; --text: #000000; --text-sec: #8e8e93; --border: #c6c6c8; --sep: #e5e5ea; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif; background-color: var(--bg); color: var(--text); padding-bottom: 150px; }
        .container { max-width: 600px; margin: 0 auto; min-height: 100vh; }
        .header { background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 100; border-bottom: 0.5px solid var(--border); padding: 0 16px; height: 50px; display: flex; align-items: center; justify-content: space-between; }
        .header h1 { font-size: 17px; font-weight: 600; margin: 0; }
        .btn-link { border: none; background: none; color: var(--primary); font-size: 17px; font-weight: 400; cursor: pointer; padding: 10px 0; }
        .panel { background: var(--card); padding: 20px 16px; display: none; }
        .panel.active { display: block; }
        .form-group { margin-bottom: 20px; }
        .label { display: block; font-size: 13px; font-weight: 500; color: var(--text-sec); text-transform: uppercase; margin-bottom: 8px; }
        .input-text { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid var(--sep); font-size: 17px; background: #fff; -webkit-appearance: none; color: #000; }
        .duty-row { display: flex; align-items: center; margin-bottom: 12px; }
        .day-label { width: 45px; font-size: 15px; font-weight: 600; }
        .time-group { flex: 1; display: flex; gap: 8px; }
        .time-input { flex: 1; padding: 10px 12px; border-radius: 8px; border: 1px solid var(--sep); font-size: 15px; background: #fff; -webkit-appearance: none; }
        .btn-danger { background: #ff3b30; color: white; padding: 8px 12px; border: none; border-radius: 8px; font-size: 13px; cursor: pointer; }

        /* v41 èª¿æ•´ï¼šMargin=0, Padding=4px, é«˜åº¦åŠ å¤§ */
        .table-section { margin-top: 0px; padding: 0 4px; background: white; min-height: 100vh; display: flex; flex-direction: column; justify-content: flex-start; }
        .table-title { font-size: 24px; font-weight: 800; margin-top: 20px; margin-bottom: 20px; text-align: center; }
        table { width: 100%; border-collapse: collapse; background: white; box-shadow: none; border-radius: 0px; overflow: hidden; }
        /* å­—é«”åŠ å¤§è‡³ 22pxï¼Œè¡Œé«˜ 65pxï¼Œé‚Šæ¡†åŠ ç²— */
        th, td { border: 2px solid #000; padding: 20px; text-align: center; font-weight: 800; font-size: 22px; height: 65px; line-height: 1.2; }
        th { background: #f5f5f5; }
        td { background: white; }
        .red-text { color: #ff3b30; }
        .btn-export { background: var(--primary); color: white; padding: 12px 24px; border: none; border-radius: 10px; font-size: 17px; font-weight: 600; cursor: pointer; width: 100%; margin-top: 12px; }
        .btn-export:active { opacity: 0.8; }
        .btn-tg { background: #0088cc; color: white; padding: 12px 24px; border: none; border-radius: 10px; font-size: 17px; font-weight: 600; cursor: pointer; width: 100%; margin-top: 12px; }
        .btn-tg:active { opacity: 0.8; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>MTR Duty Planner</h1>
            <button class="btn-link" onclick="togglePanel('input')">Edit</button>
        </div>
        <div id="inputPanel" class="panel active">
            <div class="form-group">
                <label class="label">Week / å¹´ä»½ (e.g., 2/2026)</label>
                <input type="text" id="weekInput" class="input-text" placeholder="2/2026" value="">
            </div>
            <div id="dutiesContainer"></div>
            <button class="btn-export" onclick="generateTable()">ç”Ÿæˆè¡¨æ ¼</button>
        </div>
        <div id="displayPanel" class="panel">
            <div class="table-section">
                <div id="tableOutput"></div>
            </div>
            <button class="btn-export" onclick="togglePanel('input')">â† Back to Edit</button>
            <button class="btn-tg" onclick="shareToTelegram()">ğŸ“± Share to Telegram</button>
            <button class="btn-export" onclick="exportImage()">ğŸ“¸ Export as Image</button>
        </div>
    </div>
    <script>
        function togglePanel(panel) {
            document.getElementById('inputPanel').classList.remove('active');
            document.getElementById('displayPanel').classList.remove('active');
            document.getElementById(panel + 'Panel').classList.add('active');
        }
        function generateTable() {
            const week = document.getElementById('weekInput').value;
            const duties = [];
            const rows = document.querySelectorAll('.duty-row');
            rows.forEach(row => {
                const day = row.querySelector('.day-label').textContent;
                const date = row.querySelector('.date-input')?.value || '';
                const dutyNo = row.querySelector('.duty-no-input')?.value || '';
                const bookOn = row.querySelector('.book-on-input')?.value || '';
                const bookOff = row.querySelector('.book-off-input')?.value || '';
                const workHrs = row.querySelector('.work-hrs-input')?.value || '';
                const mealBox = row.querySelector('.meal-box-input')?.value || '';
                duties.push({ day, date, dutyNo, bookOn, bookOff, workHrs, mealBox });
            });
            let tableHTML = `
                <div class="table-title">Duty of Week ${week}</div>
                <table>
                    <tr>
                        <th>Day</th>
                        <th>Date</th>
                        <th>Duty No.</th>
                        <th>Book On</th>
                        <th>Book Off</th>
                        <th>Work Hrs</th>
                        <th>Meal Box</th>
                    </tr>
            `;
            duties.forEach(duty => {
                tableHTML += `
                    <tr>
                        <td>${duty.day}</td>
                        <td>${duty.date}</td>
                        <td>${duty.dutyNo}</td>
                        <td>${duty.bookOn}</td>
                        <td>${duty.bookOff}</td>
                        <td>${duty.workHrs}</td>
                        <td class="red-text">${duty.mealBox}</td>
                    </tr>
                `;
            });
            tableHTML += '</table>';
            document.getElementById('tableOutput').innerHTML = tableHTML;
            togglePanel('display');
        }
        function exportImage() {
            const element = document.querySelector('.table-section');
            html2canvas(element, { 
                scale: 2, 
                allowTaint: true, 
                useCORS: true,
                backgroundColor: '#ffffff'
            }).then(canvas => {
                const link = document.createElement('a');
                link.href = canvas.toDataURL('image/png');
                link.download = 'mtr-duty-' + new Date().getTime() + '.png';
                link.click();
            });
        }
        function shareToTelegram() {
            const element = document.querySelector('.table-section');
            html2canvas(element, { 
                scale: 2, 
                allowTaint: true, 
                useCORS: true,
                backgroundColor: '#ffffff'
            }).then(canvas => {
                canvas.toBlob(blob => {
                    // ä¿®å¾©å¾Œçš„ Share åŠŸèƒ½
                    const file = new File([blob], 'mtr-duty-' + new Date().getTime() + '.png', { type: 'image/png' });
                    if (navigator.share) {
                        navigator.share({
                            files: [file],
                            title: 'MTR Duty Sheet',
                            text: 'Check my duty schedule!'
                        }).catch(err => {
                            console.log('Share failed:', err);
                            // å¦‚æœ Share API å¤±æ•—ï¼ˆä¾‹å¦‚é›»è…¦ç‰ˆ Chromeï¼‰ï¼Œfallback å»ä¸‹è¼‰
                            alert('åˆ†äº«å¤±æ•—æˆ–å–æ¶ˆã€‚å·²ç‚ºæ‚¨ä¸‹è¼‰åœ–ç‰‡ï¼Œè«‹æ‰‹å‹•ç™¼é€ã€‚');
                            const link = document.createElement('a');
                            link.href = canvas.toDataURL('image/png');
                            link.download = 'mtr-duty-share-fallback.png';
                            link.click();
                        });
                    } else {
                        alert('ä½ å˜…ç€è¦½å™¨å””æ”¯æ´ç›´æ¥åˆ†äº«ã€‚è«‹ç”¨ Export Image æ–¹å¼å…ˆä¸‹è¼‰ï¼Œå†æ‰‹å‹•åˆ†äº«å» Telegramã€‚');
                    }
                });
            });
        }
        function addDutyRow() {
            const container = document.getElementById('dutiesContainer');
            const rowCount = container.children.length + 1;
            const dayNames = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            const day = dayNames[rowCount - 1] || 'Day ' + rowCount;
            const row = document.createElement('div');
            row.className = 'duty-row';
            row.innerHTML = `
                <div class="day-label">${day}</div>
                <div class="time-group">
                    <input type="text" class="date-input time-input" placeholder="Date">
                    <input type="text" class="duty-no-input time-input" placeholder="Duty No.">
                    <input type="text" class="book-on-input time-input" placeholder="Book On">
                    <input type="text" class="book-off-input time-input" placeholder="Book Off">
                    <input type="text" class="work-hrs-input time-input" placeholder="Work Hrs">
                    <input type="text" class="meal-box-input time-input" placeholder="Meal">
                    <button class="btn-danger" onclick="this.parentElement.parentElement.remove()">Remove</button>
                </div>
            `;
            container.appendChild(row);
        }
        window.onload = () => {
            for (let i = 0; i < 7; i++) addDutyRow();
        };
    </script>
</body>
</html>